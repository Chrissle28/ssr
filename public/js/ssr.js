(()=>{var e={531:e=>{"use strict";e.exports=require("@babel/runtime/regenerator")},127:e=>{"use strict";e.exports=require("express")},750:e=>{"use strict";e.exports=require("puppeteer")}},r={};function t(n){var o=r[n];if(void 0!==o)return o.exports;var u=r[n]={exports:{}};return e[n](u,u.exports,t),u.exports}!function(){"use strict";var e={n:function(r){var t=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(t,{a:t}),t},d:function(r,t){for(var n in t)e.o(t,n)&&!e.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:t[n]})},o:function(e,r){return Object.prototype.hasOwnProperty.call(e,r)}},r=t(531),n=e.n(r),o=t(127),u=e.n(o),s=t(750),a=e.n(s);function c(e,r,t,n,o,u,s){try{var a=e[u](s),c=a.value}catch(e){return void t(e)}a.done?r(c):Promise.resolve(c).then(n,o)}function i(e){return function(){var r=this,t=arguments;return new Promise((function(n,o){var u=e.apply(r,t);function s(e){c(u,n,o,s,a,"next",e)}function a(e){c(u,n,o,s,a,"throw",e)}s(void 0)}))}}var p=new Map;function l(e){return f.apply(this,arguments)}function f(){return(f=i(n().mark((function e(r){var t,o,u,s,c;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a().launch();case 2:return t=e.sent,e.next=5,t.newPage();case 5:if(o=e.sent,u=Date.now(),!p.has(r)){e.next=10;break}return console.log("from cache"),e.abrupt("return",{html:p.get(r),ttRenderMs:0});case 10:return e.prev=10,e.next=13,o.goto(r,{waitUntil:"networkidle0"});case 13:e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(10),console.error(e.t0),new Error("page.goto/waitForSelector timed out.");case 19:return e.next=21,o.content();case 21:return s=e.sent,e.next=24,t.close();case 24:return c=Date.now()-u,console.info("Headless rendered page in: ".concat(c,"ms")),p.set(r,s),e.abrupt("return",{html:s,ttRenderMs:c});case 28:case"end":return e.stop()}}),e,null,[[10,15]])})))).apply(this,arguments)}function v(e,r,t,n,o,u,s){try{var a=e[u](s),c=a.value}catch(e){return void t(e)}a.done?r(c):Promise.resolve(c).then(n,o)}var d=u()();d.post("/render",function(){var e,r=(e=n().mark((function e(r,t,o){var u,s,a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l(r.query.url);case 2:return u=e.sent,s=u.html,a=u.ttRenderMs,e.prev=5,t.set("Server-Timing","Prerender;dur=".concat(a,';desc="Headless render time (ms)"')),e.abrupt("return",t.status(200).send(s));case 10:e.prev=10,e.t0=e.catch(5),o(e.t0);case 13:case"end":return e.stop()}}),e,null,[[5,10]])})),function(){var r=this,t=arguments;return new Promise((function(n,o){var u=e.apply(r,t);function s(e){v(u,n,o,s,a,"next",e)}function a(e){v(u,n,o,s,a,"throw",e)}s(void 0)}))});return function(e,t,n){return r.apply(this,arguments)}}()),d.listen(8080,(function(){return console.log("Server started. Press Ctrl+C to quit")}))}()})();